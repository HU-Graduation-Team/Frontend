<!doctype html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>بوابة الإدارة - إدارة الإجازات</title>

    <link rel="stylesheet" href="../styles.css" />
    <link rel="stylesheet" href="./hr.css" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
  </head>

  <body>
    <div class="app-container">
      <header class="app-header">
        <div class="header-content">
          <div class="header-brand">
            <div class="header-logo">
              <img src="../../Assets/شعار_جامعة_الغردقة.png" alt="شعار" />
            </div>
            <div>
              <h1>بوابة الإدارة</h1>
              <div class="subtitle">نظام إدارة الإجازات بالجامعة</div>
            </div>
          </div>

          <div class="user-info" id="userInfo">
            <div class="user-avatar" id="userAvatar">؟</div>
            <div class="user-details">
              <div class="user-name" id="userName">جاري التحميل...</div>
              <div class="user-meta">
                <span class="user-department" id="userDepartment">—</span>
              </div>
            </div>
            <i class="fa-solid fa-chevron-down user-caret"></i>

            <div class="profile-dropdown" id="profileDropdown">
              <div class="dropdown-user-info">
                <strong id="dropName">—</strong>
                <small id="dropRole">—</small>
              </div>

              <a
                href="../employee/employee.html"
                id="switchToEmployeePortal"
                class="dropdown-item"
              >
                <i class="fa-solid fa-right-left"></i>
                <span>التبديل إلى بوابة الموظف</span>
              </a>

              <a
                href="#"
                onclick="
                  showUserProfile();
                  return false;
                "
                class="dropdown-item"
              >
                <i class="fa-regular fa-user"></i>
                <span>ملفي الشخصي</span>
              </a>

              <a href="#" id="changePassBtn" class="dropdown-item">
                <i class="fa-solid fa-key"></i>
                <span>تغيير كلمة المرور</span>
              </a>

              <a href="#" id="logoutBtn" class="dropdown-item danger">
                <i class="fa-solid fa-arrow-right-from-bracket"></i>
                <span>تسجيل الخروج</span>
              </a>
            </div>
          </div>

          <div class="header-actions">
            <button
              class="icon-btn"
              id="refreshBtn"
              title="تحديث البيانات"
              type="button"
            >
              <i class="fa-solid fa-arrows-rotate"></i>
            </button>
          </div>
        </div>
      </header>

      <nav class="main-nav">
        <div class="nav-tabs">
          <button class="nav-tab active" data-tab="dashboard">
            <i class="fa-solid fa-gauge" style="font-size: 18px"></i>
            لوحة التحكم
          </button>

          <button class="nav-tab" data-tab="users">
            <i class="fa-solid fa-users" style="font-size: 18px"></i>
            المستخدمون
          </button>

          <button class="nav-tab" data-tab="org">
            <i class="fa-solid fa-building-columns" style="font-size: 18px"></i>
            الكليات والأقسام
          </button>

          <button class="nav-tab" data-tab="leaveTypes">
            <i class="fa-solid fa-list-check" style="font-size: 18px"></i>
            أنواع الإجازات
          </button>

          <button class="nav-tab" data-tab="eligibility">
            <i class="fa-solid fa-shield" style="font-size: 18px"></i>
            انواع الصلاحيات
          </button>

          <button class="nav-tab" data-tab="reports">
            <i class="fa-solid fa-chart-line" style="font-size: 18px"></i>
            التقارير
            <span class="badge urgent" id="pendingBadge">0</span>
          </button>
        </div>
      </nav>

      <div class="page-content">
        <div class="section-view active" id="view-dashboard">
          <div class="section-header">
            <div class="section-icon dashboard">
              <i class="fa-solid fa-gauge" style="font-size: 22px"></i>
            </div>
            <div class="section-title">
              <h2>لوحة التحكم</h2>
              <div class="desc">ملخص سريع لبيانات النظام</div>
            </div>
          </div>

          <div class="stats-row">
            <div class="stat-box highlight">
              <div class="label">إجمالي المستخدمين</div>
              <div class="value" id="statUsers">—</div>
              <div class="bar">
                <span id="barUsers" style="width: 0%"></span>
              </div>
            </div>

            <div class="stat-box">
              <div class="label">الكليات</div>
              <div class="value" id="statColleges">—</div>
              <div class="bar">
                <span id="barColleges" style="width: 0%"></span>
              </div>
            </div>

            <div class="stat-box">
              <div class="label">الأقسام</div>
              <div class="value" id="statDepartments">—</div>
              <div class="bar">
                <span id="barDepartments" style="width: 0%"></span>
              </div>
            </div>

            <div class="stat-box urgent">
              <div class="label">الطلبات قيد المراجعة</div>
              <div class="value" id="statPending">—</div>
              <div class="bar">
                <span id="barPending" style="width: 0%"></span>
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header dash-card-header">
              <div class="dash-title-wrap">
                <h3 class="card-title">ملخص الطلبات حسب الحالة</h3>
                <div class="muted">
                  آخر تحديث: <span id="dashUpdatedAt">—</span>
                </div>
              </div>

              <div class="dash-total">
                <span class="muted">الإجمالي</span>
                <b id="dashTotal">—</b>
              </div>
            </div>

            <div id="dashBars" class="bar-chart status-summary"></div>

            <details class="dash-note">
              <summary>ملاحظة</summary>
              <div class="muted">
                يتم جلب الأعداد من تقارير الإدارة باستخدام حد/إزاحة.
              </div>
            </details>
          </div>
        </div>

        <div class="section-view" id="view-users">
          <div class="section-header">
            <div
              class="section-icon dashboard"
              style="background: linear-gradient(135deg, #3b82f6, #60a5fa)"
            >
              <i class="fa-solid fa-users" style="font-size: 22px"></i>
            </div>
            <div class="section-title">
              <h2>إدارة المستخدمين</h2>
              <div class="desc">إضافة / تعديل / تعطيل المستخدمين</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">قائمة المستخدمين</h3>
              <div class="row" style="gap: 10px">
                <input
                  id="usersSearch"
                  placeholder="بحث بالاسم / البريد / المعرّف"
                  style="width: 260px"
                />
                <select id="usersRole" style="width: 180px">
                  <option value="">كل الأدوار</option>
                  <option value="Admin">مسؤول النظام</option>
                  <option value="Manager">مدير</option>
                  <option value="Dean">عميد</option>
                  <option value="Head_of_Department">رئيس قسم</option>
                  <option value="Employee">موظف</option>
                </select>
                <select id="usersActive" style="width: 170px">
                  <option value="">الكل</option>
                  <option value="1">نشط فقط</option>
                  <option value="0">غير نشط فقط</option>
                </select>

                <button class="btn" id="usersRefreshBtn">
                  <i class="fa-solid fa-arrows-rotate"></i> تحديث
                </button>

                <button class="btn primary" id="usersAddBtn">
                  <i class="fa-solid fa-plus"></i> إضافة مستخدم
                </button>
              </div>
            </div>

            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>المعرّف</th>
                    <th>الاسم</th>
                    <th>البريد</th>
                    <th>الدور</th>
                    <th>نوع المستخدم</th>
                    <th>القسم</th>
                    <th>الكلية</th>
                    <th>الحالة</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="usersBody">
                  <tr>
                    <td colspan="9" class="muted">—</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="section-view" id="view-org">
          <div class="section-header">
            <div
              class="section-icon dashboard"
              style="background: linear-gradient(135deg, #10b981, #34d399)"
            >
              <i
                class="fa-solid fa-building-columns"
                style="font-size: 22px"
              ></i>
            </div>
            <div class="section-title">
              <h2>الكليات والأقسام</h2>
              <div class="desc">إدارة الهيكل التنظيمي</div>
            </div>
          </div>

          <div class="grid cols-2">
            <div class="card">
              <div class="card-header">
                <h3 class="card-title">الكليات</h3>
                <div class="row" style="gap: 10px">
                  <button class="btn" id="collegesRefreshBtn">
                    <i class="fa-solid fa-arrows-rotate"></i> تحديث
                  </button>
                  <button class="btn primary" id="collegesAddBtn">
                    <i class="fa-solid fa-plus"></i> إضافة كلية
                  </button>
                </div>
              </div>

              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>المعرّف</th>
                      <th>اسم الكلية</th>
                      <th>العميد</th>
                      <th>إجراءات</th>
                    </tr>
                  </thead>
                  <tbody id="collegesBody">
                    <tr>
                      <td colspan="4" class="muted">—</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <div class="card">
              <div class="card-header">
                <h3 class="card-title">الأقسام</h3>
                <div class="row" style="gap: 10px">
                  <button class="btn" id="depsRefreshBtn">
                    <i class="fa-solid fa-arrows-rotate"></i> تحديث
                  </button>
                  <button class="btn primary" id="depsAddBtn">
                    <i class="fa-solid fa-plus"></i> إضافة قسم
                  </button>
                </div>
              </div>

              <div class="table-wrap">
                <table>
                  <thead>
                    <tr>
                      <th>المعرّف</th>
                      <th>اسم القسم</th>
                      <th>الكلية</th>
                      <th>رئيس القسم</th>
                      <th>إجراءات</th>
                    </tr>
                  </thead>
                  <tbody id="depsBody">
                    <tr>
                      <td colspan="5" class="muted">—</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        </div>

        <div class="section-view" id="view-leaveTypes">
          <div class="section-header">
            <div
              class="section-icon dashboard"
              style="background: linear-gradient(135deg, #f59e0b, #fbbf24)"
            >
              <i class="fa-solid fa-list-check" style="font-size: 22px"></i>
            </div>
            <div class="section-title">
              <h2>أنواع الإجازات</h2>
              <div class="desc">
                إنشاء وإدارة أنواع الإجازات + الوثائق + مسار الموافقات
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">قائمة الأنواع</h3>
              <div class="row" style="gap: 10px">
                <input
                  id="typesSearch"
                  placeholder="بحث بالاسم / الفئة"
                  style="width: 260px"
                />
                <button class="btn" id="typesRefreshBtn">
                  <i class="fa-solid fa-arrows-rotate"></i> تحديث
                </button>
                <button class="btn primary" id="typesAddBtn">
                  <i class="fa-solid fa-plus"></i> إضافة نوع
                </button>
              </div>
            </div>

            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>الاسم</th>
                    <th>الفئة</th>
                    <th>نوع الرصيد</th>
                    <th>الرصيد الثابت</th>
                    <th>المستندات</th>
                    <th>سياسة النوع</th>
                    <th>أقصى مدة للطلب</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="typesBody">
                  <tr>
                    <td colspan="9" class="muted">—</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="section-view" id="view-eligibility">
          <div class="section-header">
            <div
              class="section-icon dashboard"
              style="background: linear-gradient(135deg, #7c3aed, #a855f7)"
            >
              <i class="fa-solid fa-shield" style="font-size: 22px"></i>
            </div>
            <div class="section-title">
              <h2>صلاحيات أنواع الإجازات</h2>
              <div class="desc">
                تحديد من يحق له طلب نوع إجازة (الكل / أكاديمي / ...)
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">قواعد الصلاحية</h3>
              <div class="row" style="gap: 10px">
                <button class="btn" id="rulesRefreshBtn">
                  <i class="fa-solid fa-arrows-rotate"></i> تحديث
                </button>
                <button class="btn primary" id="rulesAddBtn">
                  <i class="fa-solid fa-plus"></i> إضافة قاعدة
                </button>
              </div>
            </div>

            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>رقم الإجازة</th>
                    <th>اسم الإجازة</th>
                    <th>نوع المستخدم</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="rulesBody">
                  <tr>
                    <td colspan="4" class="muted">—</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>

        <div class="section-view" id="view-reports">
          <div class="section-header">
            <div class="section-icon reports">
              <i class="fa-solid fa-chart-line" style="font-size: 22px"></i>
            </div>
            <div class="section-title">
              <h2>التقارير</h2>
              <div class="desc">
                عرض كل الطلبات + عوامل التصفية + تعديل الحالة
              </div>
            </div>
          </div>

          <div class="card">
            <div class="card-header report-header">
              <div class="report-header-top">
                <h3 class="card-title">طلبات الإجازات</h3>

                <div class="report-actions">
                  <button
                    class="btn btn-outline"
                    id="repRefreshBtn"
                    type="button"
                  >
                    تحديث التقرير
                  </button>

                  <button
                    class="btn"
                    id="repExportBtn"
                    type="button"
                    style="
                      background: #10b981;
                      color: white;
                      border: 1px solid #10b981;
                    "
                  >
                    <i class="fa-solid fa-file-excel"></i> تصدير Excel
                  </button>
                </div>
              </div>

              <div class="row report-filters" style="gap: 10px">
                <select id="repStatus" style="width: 180px">
                  <option value="">كل الحالات</option>
                  <option value="Pending">قيد المراجعة</option>
                  <option value="Approved">موافق عليه</option>
                  <option value="Rejected">مرفوض</option>
                  <option value="Cancelled">ملغي</option>
                </select>

                <select id="repDept" style="width: 220px">
                  <option value="">كل الأقسام</option>
                </select>

                <select id="repType" style="width: 220px">
                  <option value="">كل الأنواع</option>
                </select>

                <input
                  id="repUser"
                  placeholder="معرّف المستخدم أو الاسم"
                  style="width: 220px"
                />

                <input id="repStart" type="date" style="width: 170px" />
                <input id="repEnd" type="date" style="width: 170px" />

                <select id="repLimit" style="width: 120px">
                  <option value="10">١٠</option>
                  <option value="25" selected>٢٥</option>
                  <option value="50">٥٠</option>
                </select>

                <button class="btn" id="repLoadBtn" type="button">
                  <i class="fa-solid fa-magnifying-glass"></i> بحث
                </button>
              </div>
            </div>

            <div class="table-wrap">
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>الموظف</th>
                    <th>النوع</th>
                    <th>من</th>
                    <th>إلى</th>
                    <th>المدة</th>
                    <th>الحالة</th>
                    <th>إجراءات</th>
                  </tr>
                </thead>
                <tbody id="repBody">
                  <tr>
                    <td colspan="8" class="muted">—</td>
                  </tr>
                </tbody>
              </table>
            </div>

            <div
              class="row"
              style="justify-content: space-between; margin-top: 14px"
            >
              <div class="muted">
                الإجمالي: <b id="repTotal">0</b> — الصفحة:
                <b id="repPage">1</b>
              </div>
              <div class="row" style="gap: 10px">
                <button class="btn" id="repPrevBtn">
                  <i class="fa-solid fa-chevron-right"></i> السابق
                </button>
                <button class="btn" id="repNextBtn">
                  التالي <i class="fa-solid fa-chevron-left"></i>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="toast" id="toast">
      <div class="title">—</div>
      <div class="msg">—</div>
    </div>

    <div class="modal" id="modal">
      <div class="box">
        <div id="modalBody"></div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <script src="../common.js"></script>
    <script src="./hr.js"></script>
  </body>
</html>
